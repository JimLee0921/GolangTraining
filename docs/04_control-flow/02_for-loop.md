# `for` 循环

> 具体代码见：[for-loop](../../04_control-flow/02_for-loop)

## 基础语法

Go 只有一种循环语句：`for`。
语法格式：

```golang
for 初始化语句; 条件表达式; 后置语句 {
// 循环体
}
```

示例：

```go
for i := 0; i < 5; i++ {
fmt.Println(i)
}
```

---

## for 的几种常见形式

### 三段式（经典 for）

```go
for i := 0; i < 10; i++ {
fmt.Println(i)
}
```

* 和 C/Java 的 `for` 类似。
* 包含初始化、条件、后置三部分。

---

### while 风格（只有条件）

```go
i := 0
for i < 5 {
fmt.Println(i)
i++
}
```

* Go 没有 `while`，这种写法就是替代方案，将后置语句放入到循环体中

---

### 无限循环

```go
for {
fmt.Println("无限循环")
break // 需要主动跳出，否则死循环
}
```

* 省略所有部分就是无限循环。
* 通常在循环体内部设置条件配合 `break`、`return` 或 `goto` 跳出。

---

## for range 遍历集合

`for range` 用来遍历 **数组、切片、map、字符串、channel**。

### 遍历切片

```go
nums := []int{10, 20, 30}
for i, v := range nums {
fmt.Println("索引:", i, "值:", v)
}
```

### 遍历 map

```go
m := map[string]int{"a": 1, "b": 2}
for k, v := range m {
fmt.Println("键:", k, "值:", v)
}
```

### 遍历字符串

```go
for i, r := range "Go语言" {
fmt.Printf("索引 %d, rune %c\n", i, r)
}
```

### 遍历 channel

```go
ch := make(chan int, 3)
ch <- 1
ch <- 2
close(ch)

for v := range ch {
fmt.Println(v)
}
```

---

## 循环控制语句

* **break**：结束整个循环。
* **continue**：跳过本次循环，继续下一次。
* **标签配合 break/continue**：可跳出多层循环。

示例：

```go
for i := 1; i <= 5; i++ {
if i == 3 {
continue // 跳过 3
}
if i == 5 {
break // 提前结束
}
fmt.Println(i)
}
```

---

## 普通 for 与 for range 的区别

| 特性    | 普通 for       | for range               |
|-------|--------------|-------------------------|
| 适用范围  | 任意循环逻辑       | 遍历集合类型                  |
| 控制灵活性 | 高，可自由控制循环变量  | 简洁，专注遍历                 |
| 返回值   | 手动管理循环变量     | 自动提供索引/键 + 值            |
| 无限循环  | 支持（`for {}`） | 不适用                     |
| 常见场景  | 计数循环、算法、逻辑控制 | 遍历数组/切片/map/字符串/channel |

---

## for 与 for range 遍历字符串

### 为什么两种遍历存在差异

Go 的 string 是 一段只读的字节序列。 默认采用 UTF-8 编码。

而在 UTF-8 中： 英文字母通常占 1 个字节。 中文、emoji 等 Unicode 字符可能占 3~4 个字节。



---

### 用普通 `for` 遍历字符串

```go
s := "Go语言"
for i := 0; i < len(s); i++ {
fmt.Printf("索引=%d, 值=%v\n", i, s[i])
}
```

输出（不同环境可能略有差异）：

```
索引=0, 值=71    // 'G'
索引=1, 值=111   // 'o'
索引=2, 值=232   // 中文 '语' 的第1个字节
索引=3, 值=150   // 中文 '语' 的第2个字节
索引=4, 值=138   // 中文 '语' 的第3个字节
索引=5, 值=232   // 中文 '言' 的第1个字节
索引=6, 值=153   // 中文 '言' 的第2个字节
索引=7, 值=142   // 中文 '言' 的第3个字节
```

* 普通 `for` 是逐 **字节** 遍历。
* 中文被拆成了多个字节。

---

## 用 `for range` 遍历字符串

```go
s := "Go语言"
for i, r := range s {
fmt.Printf("索引=%d, rune=%c\n", i, r) // 等同于 fmt.Println("索引=",i, "rune=", r)
}
```

输出：

```
索引=0, rune=G
索引=1, rune=o
索引=2, rune=语
索引=5, rune=言
```

* `for range` 是按 **rune（Unicode 码点）** 遍历。
* 每次得到一个完整字符（即使它占多个字节）。
* 索引 `i` 是该字符在 UTF-8 编码下的 **起始字节位置**。

---

## 对比

| 特性   | 普通 for (`s[i]`) | for range (`for i, r := range s`) |
|------|-----------------|-----------------------------------|
| 遍历单位 | **字节**（byte）    | **Unicode 码点**（rune）              |
| 英文字符 | 1 字节 = 1 个字符    | 1 rune = 1 个字符                    |
| 中文字符 | 会拆成 3 个字节       | 1 rune 就是一个完整汉字                   |
| 索引含义 | 每个字节的位置         | 每个字符的起始字节位置                       |
| 常见用途 | 处理底层字节数据        | 处理文本（支持中文/emoji）                  |

---

## 推荐使用

* **需要逐字节处理**（如网络协议、二进制数据）：用普通 `for`，`for` 遍历字符串时 → **按字节**，中文会被拆开。
* **需要逐字符处理**（如字符串分析、中文处理）：用 `for range`，`for range` 遍历字符串时 → **按字符（rune）**，中文不会被拆开
