# sql.Result

用于获取执行型 SQL(INSERT / UPDATE / DELETE) 的结果摘要，不返回真正的数据，主要返回两个信息：

- 有没有新生成的主键
- 影响了多少行

```
type Result interface {
	// LastInsertId returns the integer generated by the database
	// in response to a command. Typically this will be from an
	// "auto increment" column when inserting a new row. Not all
	// databases support this feature, and the syntax of such
	// statements varies.
	LastInsertId() (int64, error)

	// RowsAffected returns the number of rows affected by an
	// update, insert, or delete. Not every database or database
	// driver may support this.
	RowsAffected() (int64, error)
}
```

> 不能把 Result 方法结果返回值作为业务真理，比如使用 UUID 作为主键，那么 `Reslut.LastInserted()` 基本就失效了

## 获取 Result

永远不是自己实现的，主要来自于 ：

```
db.Exec(...)
db.ExecContext(...)

tx.Exec(...)
tx.ExecContext(...)

stmt.Exec(...)
stmt.ExecContext(...)

conn.ExecContext(...)
```

## 接口方法

一共需要两个方法来实现 Result 接口：`LastInsertedId` 和 `RowsAffected`

### LastInsertedId()

获取自增主键，数据库在执行命令后生成的最后一个自动生成的整数 ID

```
LastInsertId() (int64, error)
```

- 不是所有数据库都支持，有的数据库禁止使用或需要特殊语法
- 不是所有 INSERT 都有
- 一定要处理 error
- 返回值和逻辑取决于数据库和驱动

### RowsAffected()

返回该 SQL 语句影响了多少行，主要适用于 UPDATE / DELETE / INSERT

```
RowsAffected() (int64, error)
```

- 主要用于判断是否真的更新了数据，乐观锁
- 返回值和逻辑取决于数据库和驱动
- 有些数据库/驱动不支持，有时返回 0 也不代表失败