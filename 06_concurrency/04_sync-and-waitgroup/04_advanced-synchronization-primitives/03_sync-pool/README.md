# sync.Pool

sync.Pool是 Go 语言标准库中提供的一个用于对象复用的工具

## 概述

sync.Pool 是一个临时对象池，用于存放可重复使用的对象，减少频繁的内存分配与 GC 压力。
频繁创建和销毁的对象（比如 bytes.Buffer、临时 slice、struct）可以放入 Pool 中循环利用。

### 特点

1. 对象缓存：使用 Get、Put 方法可以获取和归还sync.Pool中的数据，从而减轻内存分配与垃圾回收的压力
2. 自动回收：sync.Pool中的对象可能会被自动回收。这意味着即使将对象放入池中，也不能保证该对象会一直存在于池中。当内存紧张或者垃圾回收器运行时，sync.Pool中的对象可能会被回收，所以
   sync.Pool 适用于存储那些临时使用、生命周期较短的对象
3. 并发安全：sync.Pool对于并发访问是安全的。多个 goroutine 可以同时从池中获取和放回对象，而不需要额外的同步机制
4. 状态不可靠：由于sync.Pool中的对象可能会被自动回收，所以不能依赖池中对象的状态。在从池中获取对象后，应该根据具体的使用场景对对象进行初始化，以确保对象处于正确的状态

### 使用场景

1. 频繁创建和销毁对象
2. 减少内存分配压力

### 基本结构

```
type Pool struct {
    New func() any
}
```


- New：可选函数，用于在池子里没有可用对象时，创建一个新对象
- Get()：从池中取对象（若空则调用 New() 创建），因为返回值是 interface{}，因此需要类型转换
- Put(x)：在对象使用完毕后，返回对象池
- 池中的对象会被 GC 自动清空（不适合长期持有重要资源）